<Macro Headers>
        SetEnvIf Request_Method POST REQUEST_IS_POST=1
        SetEnvIf Request_URI ^/gateway.* REQUEST_IS_POST=1
        SetEnvIf Request_URI ^/gwt/RegattaOverview.* REQUEST_IS_POST=1
        SetEnvIf Request_URI ^/?$ REQUEST_IS_POST=1

        Header set Expires "Sun, 19 Nov 1978 05:00:00 GMT" env=REQUEST_IS_POST
        Header set Cache-Control no-cache,no-store,must-revalidate,post-check=0,pre-check=0 env=REQUEST_IS_POST

        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/json
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE image/gif
        AddOutputFilterByType DEFLATE image/png
        AddOutputFilterByType DEFLATE image/jpeg
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript

        AllowEncodedSlashes On
</Macro>

<Macro Rewrite $IP $PORT>
        RewriteRule ^/(.*)$ http://$IP:$PORT/$1 [P,L]
        ProxyPassReverse / http://$IP:$PORT/
	ProxyPreserveHost On
</Macro>

<Macro SSL>
        SSLEngine  On
        SSLCertificateFile /etc/pki/tls/certs/star_sapsailing_com.crt
        SSLCertificateKeyFile /etc/pki/tls/private/star_sapsailing_com.key
        SSLCertificateChainFile /etc/pki/tls/certs/server-chain.crt
</Macro>

<Macro Status $HOSTNAME $PATH>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        <Location /$PATH>
            SetHandler server-status
            Order deny,allow
            Allow from all
        </Location>
        CustomLog logs/services_log combined
    </VirtualHost>
</Macro>

<Macro Home $HOSTNAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers
        RewriteEngine on
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html" [L,NE]
        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Home-SSL $HOSTNAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers
        RewriteEngine on
        RewriteRule ^(/)?$ "https://$HOSTNAME/gwt/Home.html" [L,NE]
        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Plain $HOSTNAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        Use Headers
        RewriteEngine on
        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Plain-SSL $HOSTNAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers
        RewriteEngine on
        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro HardRedirect $HOSTNAME $TARGETURL>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        Use Headers
        RedirectMatch /(.*)$ $TARGETURL/
    </VirtualHost>
</Macro>

<Macro LiveCenterWithLanguageSubstitution-ARCHIVE $HOSTNAME $EVENTUUID>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on


        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?locale=de#/event/:eventId=$EVENTUUID" [L,NE]

        RewriteCond %{REQUEST_URI} "^/en$"
        RewriteRule ^(/en)?$ "http://$HOSTNAME/gwt/Home.html?locale=en#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro LiveCenterWithLanguageSubstitution $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on


        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?locale=de#/event/:eventId=$EVENTUUID" [L,NE]

        RewriteCond %{REQUEST_URI} "^/en$"
        RewriteRule ^(/en)?$ "http://$HOSTNAME/gwt/Home.html?locale=en#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro RibDashboard $HOSTNAME $LEADERBOARD_NAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/dashboards/RibDashboard.html?leaderboardName=$LEADERBOARD_NAME&%1" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>


<Macro RegattaOverview-WithLeaderboard-WithLanguage $HOSTNAME $EVENTUUID $LANG $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/RegattaOverview.html?event=$EVENTUUID&locale=$LANG&enableLeaderboard=true" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro RegattaOverview-WithLanguage $HOSTNAME $EVENTUUID $LANG $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/RegattaOverview.html?event=$EVENTUUID&locale=$LANG" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro RegattaOverview-WithLeaderboard $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/RegattaOverview.html?event=$EVENTUUID&enableLeaderboard=true" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Event $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?%1#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Event-SSL-Redirect $HOSTNAME $EVENTUUID $IP $PORT>
    Use RedirectPermanentToSSL $HOSTNAME
    Use Event-SSL $HOSTNAME $EVENTUUID $IP $PORT
</Macro>

<Macro RedirectPermanentToSSL $HOSTNAME>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>
</Macro>

<Macro Event-SSL $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "https://$HOSTNAME/gwt/Home.html?%1#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Series $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?%1#/series/:seriesId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Series-SSL $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "https://$HOSTNAME/gwt/Home.html?%1#/series/:seriesId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro EventRegattaIntro $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?%1#/regatta/overview/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Event-WithLanguage $HOSTNAME $EVENTUUID $LANG $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?locale=$LANG#EventPlace:eventId=$EVENTUUID" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Event-ARCHIVE $HOSTNAME $EVENTUUID>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Home.html?%1#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro Event-ARCHIVE-SSL $HOSTNAME $EVENTUUID>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "https://$HOSTNAME/gwt/Home.html?%1#/event/:eventId=$EVENTUUID" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>


<Macro RegattaOverview $HOSTNAME $EVENTUUID $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
	# The following matches the query string and captures it in group %1 for the RewriteRule to use before the fragment
	RewriteCond %{QUERY_STRING} "^(.*)$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/RegattaOverview.html?event=$EVENTUUID&%1" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Events $HOSTNAME $EVENTNAME $EXTRA $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/events/$EVENTNAME/$EXTRA" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Spectator-WithParam $HOSTNAME $GROUPNAME $EXTRA $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&$EXTRA" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Spectator-WithLanguage $HOSTNAME $GROUPNAME $LANG $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&showRaceDetails=true&locale=$LANG" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Spectator $HOSTNAME $GROUPNAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&showRaceDetails=true" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Leaderboard $HOSTNAME $GROUPNAME $NAME $IP $PORT>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Leaderboard.html?name=$NAME&leaderboardGroupName=$GROUPNAME&showRaceDetails=true&root=leaderboardGroupPanel" [L,NE]

        Use Rewrite $IP $PORT
    </VirtualHost>
</Macro>

<Macro Leaderboard-WithParam $HOSTNAME $GROUPNAME $NAME $EXTRA $IP $PORT>
    <VirtualHost *:80>
       ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Leaderboard.html?name=$NAME&leaderboardGroupName=$GROUPNAME&$EXTRA" [L,NE]

        Use Rewrite-ARCHIVE1
    </VirtualHost>
</Macro>

<Macro Spectator-ARCHIVE $HOSTNAME $GROUPNAME>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&showRaceDetails=true" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro Spectator-ARCHIVE-SSL $HOSTNAME $GROUPNAME>
    <VirtualHost *:80>
        ServerName $HOSTNAME
        RedirectPermanent / https://$HOSTNAME/
    </VirtualHost>

    <VirtualHost *:443>
        ServerName $HOSTNAME
        Use SSL
        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "https://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&showRaceDetails=true" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro Spectator-ARCHIVE-WithParam $HOSTNAME $GROUPNAME $EXTRA>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&$EXTRA" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro Events-ARCHIVE $HOSTNAME $EVENTNAME $EXTRA>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/events/$EVENTNAME/$EXTRA" [L,NE]

        Use Rewrite 172.31.30.89 8888
    </VirtualHost>
</Macro>

<Macro Spectator-DEV $HOSTNAME $GROUPNAME>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&showRaceDetails=true" [L,NE]

        Use Rewrite 172.31.18.218 8888
    </VirtualHost>
</Macro>

<Macro Spectator-DEV-WithParam $HOSTNAME $GROUPNAME $EXTRA>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/gwt/Spectator.html?leaderboardGroupName=$GROUPNAME&$EXTRA" [L,NE]

        Use Rewrite 172.31.18.218 8888
    </VirtualHost>
</Macro>

<Macro Events-DEV $HOSTNAME $EVENTNAME $EXTRA>
    <VirtualHost *:80>
        ServerName $HOSTNAME

        Use Headers

        RewriteEngine on

        RewriteCond %{REQUEST_URI} "^(/)?$"
        RewriteRule ^(/)?$ "http://$HOSTNAME/events/$EVENTNAME/$EXTRA" [L,NE]

        Use Rewrite 172.31.18.218 8888
    </VirtualHost>
</Macro>
